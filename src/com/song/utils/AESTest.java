package com.song.utils;

import org.apache.commons.io.IOUtils;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.util.Arrays;
import java.util.zip.GZIPInputStream;

public class AESTest {

    @Test
    public void test_aes() throws Exception {

        String key = "0123456789012345";
        String iv = "0123456789012345";

//        String data = "010000006056E09A13237FA846FDBC82B695C85B4694469B8F66C7B2EB8061E2B93AF769BB91262DF6C7794750EFDAA956678DAD14C21AFC2E4FA6FFB72C07C488E80164BA025CCECC2FD3352973FFDF277F10588DEBA3D2F852E4BE58B2BB7327902CF5C500010000007056E09A13237FA846FDBC82B695C85B46D39ED5B27E508B3834827FC118CC1566EEC6B323DD07E7550EB8BB494B2018D22A16EB40D516E9808E5B9BAFE791081856C9A7570CD88F5CC8198B33AA6D0A9FF9B331C2FE3347F4DE1EE42CA65128DEF3D1E05A881C2B748C2D87FF87109E670001000000A056E09A13237FA846FDBC82B695C85B46D39ED5B27E508B3834827FC118CC1566EEC6B323DD07E7550EB8BB494B2018D2944FFA18DB52FE1448C479C9D78F16DE16CA2085813AD18F4E90DA4EF124BC0C0A172935DDC725F13301E92AE96B6B41D199FFEB574BDBBE82F06E0BFA6DDD5F3EC9671EF2D91FD8ED94FE8A13A4F9C3775BAEF6D8362A32951801B639776AC198808A15F65B4DD5DA185B583136810000";
        String data = "013830F6F941C450CA014716E3B541556CDA579505C3D0639B8A447A7E9E517DB2BBBFAF3D09E600D040F8B525CB10AA52DB62A6FCD3A212460835A42495A40E22570D1593011D20CC13B377E8D213E5B20A7F013131320545FDCF508EFCD8A7C80BC18727566177F686D4243E876A7DFD9292EC7BAD918C4BD08A3F5B20B196832F91B88EC79E3B72F34B9292F039BA2BB7B1B380A711CAC095E9B42B1FA518C369F006D5768AC8A5BAF47EAB6D6D1872AED0A0EA69F69A69C56E4C9637C339B48D75A49679F5013131320545FDCF508EFCD8A7C80BC18727566177F686D4243E876A7DFD9292EC7BAD918C4BD08A3F5B20B196832F91B88EC79E5F73CE2AD3403388FF1911A8EBD8566326793FB004D44BED753F67A106B589E7CBFB685C36D7492547A3CBAB9F6F746E38854EF14BC3E7010391A43F76044940013131320545FDCF508EFCD8A7C80BC18727566177F686D4243E876A7DFD9292EC7BAD918C4BD08A3F5B20B196832F91B88EC79E0AE6BFFAE55F87AD14791D2AAB65AEF1AB89356C964F824649047014ED4F0FA1BEEAC3E5BCDE9F1A4B508D08FA2EF5413432F2AC8D73B98D12674A77EBB6C8F1013131320545FDCF508EFCD8A7C80BC18727566177F686D4243E876A7DFD9292EC7BAD918C4BD08A3F5B20B196832F91B88EC79E78BED8F823E0909962A8C8BAA1E3F1BFFC32196F8A44E36C2C42734DE5EF4E7BA1535B03D13B438E1C06FDECC0E735518B3ABE6B729904F036407A55579981A7013131320545FDCF508EFCD8A7C80BC18727566177F686D4243E876A7DFD9292EC7BAD918C4BD08A3F5B20B196832F91B88EC79EFA91B5D59B9288977E58E9CB58CD4F38B38E36B45F14DDAE68E9DB72690370381BA1A57B73942CA6D610A14AD3EA8A97B9E22386B0F5CEBEBF2C315CBDC7DD2B";
        byte[] origin = HexUtils.hexToBytes(data);

        System.out.println(origin[0]);
        byte[] len = Arrays.copyOfRange(origin, 1, 5);
        int s = (len[0] & 0xff) << 24 | (len[1] & 0xff) << 16 | (len[2] & 0xff) << 8 | (len[3] & 0xff);
        System.out.println(s);

        byte[] cipherText = Arrays.copyOfRange(origin, 5, 5 + s);
        byte[] plainText = AESUtils.decrypt(key, iv, cipherText);

        // 解压缩
        byte[] decompress = decompress(plainText);
        System.out.println(new String(decompress));

    }

    private static byte[] decompress(byte[] contentBytes) throws Exception {
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        IOUtils.copy(new GZIPInputStream(new ByteArrayInputStream(contentBytes)), out);
        return out.toByteArray();
    }

}
